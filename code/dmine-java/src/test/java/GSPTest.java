import org.junit.jupiter.api.Test;

import java.util.List;
import java.util.Set;

import static org.junit.jupiter.api.Assertions.*;


/**
 * @author rliu 2022-04
 */
class GSPTest {

    String printResults(List<GSP.GSPLevelStruct> results) {
        StringBuilder sb = new StringBuilder();

        int k = 1;
        for (GSP.GSPLevelStruct gs : results) {
            List<String> msg = List.of(
                "--------------------------",
                "Level " + k++ + ": ",
                String.format("\tPruned: (%d)", gs.pruned().size()),
                SeqUtils.printSeqs(gs.pruned()),
                String.format("\tFrequent pruned: (%d)", gs.frequent_pruned().size()),
                SeqUtils.printSeqs(gs.frequent_pruned()),
                String.format("\tCandidates: (%d)", gs.candidates().size()),
                SeqUtils.printSeqs(gs.candidates())
//                String.format("\tFrequent candidates: (%d)", gs.frequent_candidates().size()),
//                SeqUtils.printSeqs(gs.frequent_candidates())
            );
            msg.forEach(s -> sb.append(s).append("\n"));
        }

        return sb.toString();
    }


    @Test
    void mineTestBasic1() {
        List<List<Set<Integer>>> tdb = List.of(
            List.of(Set.of(2, 4), Set.of(3), Set.of(2), Set.of(1, 3)),             // (bd)cb(ac)
            List.of(Set.of(2, 6), Set.of(3, 5), Set.of(2), Set.of(6, 7)),          // (bf)(ce)b(fg)
            List.of(Set.of(1, 8), Set.of(2, 6), Set.of(1), Set.of(2), Set.of(6)),  // (ah)(bf)abf
            List.of(Set.of(2, 5), Set.of(3, 5), Set.of(4)),                        // (be)(ce)d
            List.of(Set.of(1), Set.of(2, 4), Set.of(2), Set.of(3), Set.of(2), Set.of(1, 4, 5)) // a(bd)bcb(ade)
        );
        /**
         * [[4, 2], [3], [2], [3, 1]]
         * [[6, 2], [5, 3], [2], [7, 6]]
         * [[8, 1], [6, 2], [1], [2], [6]]
         * [[5, 2], [5, 3], [4]]
         * [[1], [4, 2], [2], [3], [2], [4, 5, 1]]
         */

        String result;

        String corr1 =
            "--------------------------\n" +
                "Level 1: \n" +
                "\tPruned: (8)\n" +
                "[[1]]\n" +
                "[[2]]\n" +
                "[[3]]\n" +
                "[[4]]\n" +
                "[[5]]\n" +
                "[[6]]\n" +
                "[[7]]\n" +
                "[[8]]\n" +
                "\n" +
                "\tFrequent pruned: (6)\n" +
                "[[1]]\n" +
                "[[2]]\n" +
                "[[3]]\n" +
                "[[4]]\n" +
                "[[5]]\n" +
                "[[6]]\n" +
                "\n" +
                "\tCandidates: (51)\n" +
                "[[1], [1]]\n" +
                "[[1], [2]]\n" +
                "[[1, 2]]\n" +
                "[[1], [3]]\n" +
                "[[1, 3]]\n" +
                "[[1], [4]]\n" +
                "[[1, 4]]\n" +
                "[[1], [5]]\n" +
                "[[1, 5]]\n" +
                "[[1], [6]]\n" +
                "[[1, 6]]\n" +
                "[[2], [1]]\n" +
                "[[2], [2]]\n" +
                "[[2], [3]]\n" +
                "[[2, 3]]\n" +
                "[[2], [4]]\n" +
                "[[2, 4]]\n" +
                "[[2], [5]]\n" +
                "[[2, 5]]\n" +
                "[[2], [6]]\n" +
                "[[2, 6]]\n" +
                "[[3], [1]]\n" +
                "[[3], [2]]\n" +
                "[[3], [3]]\n" +
                "[[3], [4]]\n" +
                "[[3, 4]]\n" +
                "[[3], [5]]\n" +
                "[[3, 5]]\n" +
                "[[3], [6]]\n" +
                "[[3, 6]]\n" +
                "[[4], [1]]\n" +
                "[[4], [2]]\n" +
                "[[4], [3]]\n" +
                "[[4], [4]]\n" +
                "[[4], [5]]\n" +
                "[[4, 5]]\n" +
                "[[4], [6]]\n" +
                "[[4, 6]]\n" +
                "[[5], [1]]\n" +
                "[[5], [2]]\n" +
                "[[5], [3]]\n" +
                "[[5], [4]]\n" +
                "[[5], [5]]\n" +
                "[[5], [6]]\n" +
                "[[5, 6]]\n" +
                "[[6], [1]]\n" +
                "[[6], [2]]\n" +
                "[[6], [3]]\n" +
                "[[6], [4]]\n" +
                "[[6], [5]]\n" +
                "[[6], [6]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 2: \n" +
                "\tPruned: (31)\n" +
                "[[2], [1]]\n" +
                "[[4], [3]]\n" +
                "[[2], [2]]\n" +
                "[[6], [6]]\n" +
                "[[2], [3]]\n" +
                "[[2], [4]]\n" +
                "[[2], [5]]\n" +
                "[[2], [6]]\n" +
                "[[3], [1]]\n" +
                "[[3], [2]]\n" +
                "[[1], [1]]\n" +
                "[[1], [2]]\n" +
                "[[1, 2]]\n" +
                "[[3], [4]]\n" +
                "[[1, 3]]\n" +
                "[[1, 4]]\n" +
                "[[2, 3]]\n" +
                "[[1, 5]]\n" +
                "[[2, 4]]\n" +
                "[[1, 6]]\n" +
                "[[2, 5]]\n" +
                "[[3, 4]]\n" +
                "[[2, 6]]\n" +
                "[[3, 5]]\n" +
                "[[3, 6]]\n" +
                "[[4, 5]]\n" +
                "[[4, 6]]\n" +
                "[[5, 6]]\n" +
                "[[6], [2]]\n" +
                "[[4], [1]]\n" +
                "[[4], [2]]\n" +
                "\n" +
                "\tFrequent pruned: (19)\n" +
                "[[2], [1]]\n" +
                "[[4], [3]]\n" +
                "[[3], [2]]\n" +
                "[[2], [2]]\n" +
                "[[6], [6]]\n" +
                "[[1], [1]]\n" +
                "[[2], [3]]\n" +
                "[[1], [2]]\n" +
                "[[3], [4]]\n" +
                "[[2], [4]]\n" +
                "[[2], [5]]\n" +
                "[[2], [6]]\n" +
                "[[2, 4]]\n" +
                "[[2, 6]]\n" +
                "[[3, 5]]\n" +
                "[[6], [2]]\n" +
                "[[4], [1]]\n" +
                "[[3], [1]]\n" +
                "[[4], [2]]\n" +
                "\n" +
                "\tCandidates: (71)\n" +
                "[[2], [1], [1]]\n" +
                "[[2], [1], [2]]\n" +
                "[[4], [3], [2]]\n" +
                "[[4], [3], [4]]\n" +
                "[[4], [3, 5]]\n" +
                "[[4], [3], [1]]\n" +
                "[[3], [2], [1]]\n" +
                "[[3], [2], [2]]\n" +
                "[[3], [2], [3]]\n" +
                "[[3], [2], [4]]\n" +
                "[[3], [2], [5]]\n" +
                "[[3], [2], [6]]\n" +
                "[[3], [2, 4]]\n" +
                "[[3], [2, 6]]\n" +
                "[[2], [2], [1]]\n" +
                "[[2], [2], [2]]\n" +
                "[[2], [2], [3]]\n" +
                "[[2], [2], [4]]\n" +
                "[[2], [2], [5]]\n" +
                "[[2], [2], [6]]\n" +
                "[[2], [2, 4]]\n" +
                "[[2], [2, 6]]\n" +
                "[[6], [6], [6]]\n" +
                "[[6], [6], [2]]\n" +
                "[[1], [1], [1]]\n" +
                "[[1], [1], [2]]\n" +
                "[[2], [3], [2]]\n" +
                "[[2], [3], [4]]\n" +
                "[[2], [3, 5]]\n" +
                "[[2], [3], [1]]\n" +
                "[[1], [2], [1]]\n" +
                "[[1], [2], [2]]\n" +
                "[[1], [2], [3]]\n" +
                "[[1], [2], [4]]\n" +
                "[[1], [2], [5]]\n" +
                "[[1], [2], [6]]\n" +
                "[[1], [2, 4]]\n" +
                "[[1], [2, 6]]\n" +
                "[[3], [4], [3]]\n" +
                "[[3], [4], [1]]\n" +
                "[[3], [4], [2]]\n" +
                "[[2], [4], [3]]\n" +
                "[[2], [4], [1]]\n" +
                "[[2], [4], [2]]\n" +
                "[[2], [6], [6]]\n" +
                "[[2], [6], [2]]\n" +
                "[[2, 4], [3]]\n" +
                "[[2, 4], [1]]\n" +
                "[[2, 4], [2]]\n" +
                "[[2, 6], [6]]\n" +
                "[[2, 6], [2]]\n" +
                "[[6], [2], [1]]\n" +
                "[[6], [2], [2]]\n" +
                "[[6], [2], [3]]\n" +
                "[[6], [2], [4]]\n" +
                "[[6], [2], [5]]\n" +
                "[[6], [2], [6]]\n" +
                "[[6], [2, 4]]\n" +
                "[[6], [2, 6]]\n" +
                "[[4], [1], [1]]\n" +
                "[[4], [1], [2]]\n" +
                "[[3], [1], [1]]\n" +
                "[[3], [1], [2]]\n" +
                "[[4], [2], [1]]\n" +
                "[[4], [2], [2]]\n" +
                "[[4], [2], [3]]\n" +
                "[[4], [2], [4]]\n" +
                "[[4], [2], [5]]\n" +
                "[[4], [2], [6]]\n" +
                "[[4], [2, 4]]\n" +
                "[[4], [2, 6]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 3: \n" +
                "\tPruned: (20)\n" +
                "[[2], [2], [1]]\n" +
                "[[2], [3], [2]]\n" +
                "[[1], [2], [2]]\n" +
                "[[4], [3], [1]]\n" +
                "[[3], [2], [1]]\n" +
                "[[4], [3], [2]]\n" +
                "[[2], [2], [3]]\n" +
                "[[2], [3], [4]]\n" +
                "[[4], [2], [1]]\n" +
                "[[4], [2], [3]]\n" +
                "[[2], [2], [6]]\n" +
                "[[2], [3, 5]]\n" +
                "[[6], [2], [6]]\n" +
                "[[2, 6], [2]]\n" +
                "[[2, 4], [1]]\n" +
                "[[2, 4], [2]]\n" +
                "[[2, 4], [3]]\n" +
                "[[2], [3], [1]]\n" +
                "[[1], [2], [1]]\n" +
                "[[2, 6], [6]]\n" +
                "\n" +
                "\tFrequent pruned: (20)\n" +
                "[[2], [2], [1]]\n" +
                "[[2], [3], [2]]\n" +
                "[[1], [2], [2]]\n" +
                "[[4], [3], [1]]\n" +
                "[[3], [2], [1]]\n" +
                "[[4], [3], [2]]\n" +
                "[[2], [2], [3]]\n" +
                "[[2], [3], [4]]\n" +
                "[[4], [2], [1]]\n" +
                "[[4], [2], [3]]\n" +
                "[[2], [2], [6]]\n" +
                "[[2], [3, 5]]\n" +
                "[[6], [2], [6]]\n" +
                "[[2, 6], [2]]\n" +
                "[[2, 4], [1]]\n" +
                "[[2, 4], [2]]\n" +
                "[[2, 4], [3]]\n" +
                "[[2], [3], [1]]\n" +
                "[[1], [2], [1]]\n" +
                "[[2, 6], [6]]\n" +
                "\n" +
                "\tCandidates: (18)\n" +
                "[[2], [3], [2], [1]]\n" +
                "[[1], [2], [2], [1]]\n" +
                "[[1], [2], [2], [3]]\n" +
                "[[1], [2], [2], [6]]\n" +
                "[[4], [3], [2], [1]]\n" +
                "[[2], [2], [3], [2]]\n" +
                "[[2], [2], [3], [4]]\n" +
                "[[2], [2], [3, 5]]\n" +
                "[[2], [2], [3], [1]]\n" +
                "[[4], [2], [3], [2]]\n" +
                "[[4], [2], [3], [4]]\n" +
                "[[4], [2], [3, 5]]\n" +
                "[[4], [2], [3], [1]]\n" +
                "[[2, 6], [2], [6]]\n" +
                "[[2, 4], [2], [1]]\n" +
                "[[2, 4], [2], [3]]\n" +
                "[[2, 4], [3], [1]]\n" +
                "[[2, 4], [3], [2]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 4: \n" +
                "\tPruned: (7)\n" +
                "[[4], [3], [2], [1]]\n" +
                "[[2, 4], [3], [1]]\n" +
                "[[2, 4], [2], [1]]\n" +
                "[[2, 4], [3], [2]]\n" +
                "[[2, 4], [2], [3]]\n" +
                "[[2, 6], [2], [6]]\n" +
                "[[2], [3], [2], [1]]\n" +
                "\n" +
                "\tFrequent pruned: (7)\n" +
                "[[4], [3], [2], [1]]\n" +
                "[[2, 4], [3], [1]]\n" +
                "[[2, 4], [2], [1]]\n" +
                "[[2, 4], [3], [2]]\n" +
                "[[2, 4], [2], [3]]\n" +
                "[[2, 6], [2], [6]]\n" +
                "[[2], [3], [2], [1]]\n" +
                "\n" +
                "\tCandidates: (1)\n" +
                "[[2, 4], [3], [2], [1]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 5: \n" +
                "\tPruned: (1)\n" +
                "[[2, 4], [3], [2], [1]]\n" +
                "\n" +
                "\tFrequent pruned: (1)\n" +
                "[[2, 4], [3], [2], [1]]\n" +
                "\n" +
                "\tCandidates: (0)\n" +
                "\n";

        System.out.println(SeqUtils.printSeqs(tdb));

        GSP gsp = new GSP(() -> tdb);
        List<GSP.GSPLevelStruct> ret = gsp.mine(2);
        TestUtils.StringEquals("gsp basic 1", corr1, printResults(ret), true);
    }

    @Test
    void mineTestBasic2() {
        List<List<Set<Integer>>> tdb = List.of(
            List.of(Set.of(1), Set.of(2), Set.of(6, 7), Set.of(3), Set.of(4)),  // <AB(FG)CD>
            List.of(Set.of(2), Set.of(7), Set.of(4)),                           // <BGD>
            List.of(Set.of(2), Set.of(6), Set.of(7), Set.of(1, 2)),             // <BFG(AB)>
            List.of(Set.of(6), Set.of(1, 2), Set.of(3), Set.of(4)),             // <F(AB)CD>
            List.of(Set.of(1), Set.of(2, 3), Set.of(7), Set.of(6), Set.of(4, 5))  // <A(BC)GF(DE)>
        );
        /**
         * [[1], [2], [6, 7], [3], [4]]
         * [[2], [7], [4]]
         * [[2], [6], [7], [1, 2]]
         * [[6], [1, 2], [3], [4]]
         * [[1], [2, 3], [7], [6], [4, 5]]
         */

        String result;

        String corr1 =
            "--------------------------\n" +
                "Level 1: \n" +
                "\tPruned: (7)\n" +
                "[[1]]\n" +
                "[[2]]\n" +
                "[[3]]\n" +
                "[[4]]\n" +
                "[[5]]\n" +
                "[[6]]\n" +
                "[[7]]\n" +
                "\n" +
                "\tFrequent pruned: (6)\n" +
                "[[1]]\n" +
                "[[2]]\n" +
                "[[3]]\n" +
                "[[4]]\n" +
                "[[6]]\n" +
                "[[7]]\n" +
                "\n" +
                "\tCandidates: (51)\n" +
                "[[1], [1]]\n" +
                "[[1], [2]]\n" +
                "[[1, 2]]\n" +
                "[[1], [3]]\n" +
                "[[1, 3]]\n" +
                "[[1], [4]]\n" +
                "[[1, 4]]\n" +
                "[[1], [6]]\n" +
                "[[1, 6]]\n" +
                "[[1], [7]]\n" +
                "[[1, 7]]\n" +
                "[[2], [1]]\n" +
                "[[2], [2]]\n" +
                "[[2], [3]]\n" +
                "[[2, 3]]\n" +
                "[[2], [4]]\n" +
                "[[2, 4]]\n" +
                "[[2], [6]]\n" +
                "[[2, 6]]\n" +
                "[[2], [7]]\n" +
                "[[2, 7]]\n" +
                "[[3], [1]]\n" +
                "[[3], [2]]\n" +
                "[[3], [3]]\n" +
                "[[3], [4]]\n" +
                "[[3, 4]]\n" +
                "[[3], [6]]\n" +
                "[[3, 6]]\n" +
                "[[3], [7]]\n" +
                "[[3, 7]]\n" +
                "[[4], [1]]\n" +
                "[[4], [2]]\n" +
                "[[4], [3]]\n" +
                "[[4], [4]]\n" +
                "[[4], [6]]\n" +
                "[[4, 6]]\n" +
                "[[4], [7]]\n" +
                "[[4, 7]]\n" +
                "[[6], [1]]\n" +
                "[[6], [2]]\n" +
                "[[6], [3]]\n" +
                "[[6], [4]]\n" +
                "[[6], [6]]\n" +
                "[[6], [7]]\n" +
                "[[6, 7]]\n" +
                "[[7], [1]]\n" +
                "[[7], [2]]\n" +
                "[[7], [3]]\n" +
                "[[7], [4]]\n" +
                "[[7], [6]]\n" +
                "[[7], [7]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 2: \n" +
                "\tPruned: (30)\n" +
                "[[2], [3]]\n" +
                "[[2], [4]]\n" +
                "[[2], [6]]\n" +
                "[[2], [7]]\n" +
                "[[7], [4]]\n" +
                "[[1], [2]]\n" +
                "[[1, 2]]\n" +
                "[[3], [4]]\n" +
                "[[1], [3]]\n" +
                "[[1, 3]]\n" +
                "[[1], [4]]\n" +
                "[[1, 4]]\n" +
                "[[2, 3]]\n" +
                "[[2, 4]]\n" +
                "[[1], [6]]\n" +
                "[[1, 6]]\n" +
                "[[3, 4]]\n" +
                "[[1], [7]]\n" +
                "[[1, 7]]\n" +
                "[[2, 6]]\n" +
                "[[2, 7]]\n" +
                "[[3, 6]]\n" +
                "[[3, 7]]\n" +
                "[[4, 6]]\n" +
                "[[4, 7]]\n" +
                "[[6, 7]]\n" +
                "[[6], [1]]\n" +
                "[[6], [2]]\n" +
                "[[6], [3]]\n" +
                "[[6], [4]]\n" +
                "\n" +
                "\tFrequent pruned: (16)\n" +
                "[[2], [3]]\n" +
                "[[1], [2]]\n" +
                "[[1, 2]]\n" +
                "[[3], [4]]\n" +
                "[[2], [4]]\n" +
                "[[1], [3]]\n" +
                "[[1], [4]]\n" +
                "[[2], [6]]\n" +
                "[[2], [7]]\n" +
                "[[1], [6]]\n" +
                "[[1], [7]]\n" +
                "[[6], [1]]\n" +
                "[[6], [2]]\n" +
                "[[7], [4]]\n" +
                "[[6], [3]]\n" +
                "[[6], [4]]\n" +
                "\n" +
                "\tCandidates: (31)\n" +
                "[[2], [3], [4]]\n" +
                "[[1], [2], [3]]\n" +
                "[[1], [2], [4]]\n" +
                "[[1], [2], [6]]\n" +
                "[[1], [2], [7]]\n" +
                "[[1, 2], [3]]\n" +
                "[[1, 2], [4]]\n" +
                "[[1, 2], [6]]\n" +
                "[[1, 2], [7]]\n" +
                "[[1], [3], [4]]\n" +
                "[[2], [6], [1]]\n" +
                "[[2], [6], [2]]\n" +
                "[[2], [6], [3]]\n" +
                "[[2], [6], [4]]\n" +
                "[[2], [7], [4]]\n" +
                "[[1], [6], [1]]\n" +
                "[[1], [6], [2]]\n" +
                "[[1], [6], [3]]\n" +
                "[[1], [6], [4]]\n" +
                "[[1], [7], [4]]\n" +
                "[[6], [1], [2]]\n" +
                "[[6], [1, 2]]\n" +
                "[[6], [1], [3]]\n" +
                "[[6], [1], [4]]\n" +
                "[[6], [1], [6]]\n" +
                "[[6], [1], [7]]\n" +
                "[[6], [2], [3]]\n" +
                "[[6], [2], [4]]\n" +
                "[[6], [2], [6]]\n" +
                "[[6], [2], [7]]\n" +
                "[[6], [3], [4]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 3: \n" +
                "\tPruned: (11)\n" +
                "[[1], [3], [4]]\n" +
                "[[2], [3], [4]]\n" +
                "[[1], [2], [4]]\n" +
                "[[1], [2], [6]]\n" +
                "[[1], [2], [7]]\n" +
                "[[6], [3], [4]]\n" +
                "[[1], [7], [4]]\n" +
                "[[2], [7], [4]]\n" +
                "[[1], [6], [4]]\n" +
                "[[6], [1, 2]]\n" +
                "[[2], [6], [4]]\n" +
                "\n" +
                "\tFrequent pruned: (11)\n" +
                "[[1], [3], [4]]\n" +
                "[[2], [3], [4]]\n" +
                "[[1], [2], [4]]\n" +
                "[[1], [2], [6]]\n" +
                "[[1], [2], [7]]\n" +
                "[[6], [3], [4]]\n" +
                "[[1], [7], [4]]\n" +
                "[[2], [7], [4]]\n" +
                "[[1], [6], [4]]\n" +
                "[[6], [1, 2]]\n" +
                "[[2], [6], [4]]\n" +
                "\n" +
                "\tCandidates: (2)\n" +
                "[[1], [2], [6], [4]]\n" +
                "[[1], [2], [7], [4]]\n" +
                "\n" +
                "--------------------------\n" +
                "Level 4: \n" +
                "\tPruned: (2)\n" +
                "[[1], [2], [7], [4]]\n" +
                "[[1], [2], [6], [4]]\n" +
                "\n" +
                "\tFrequent pruned: (2)\n" +
                "[[1], [2], [7], [4]]\n" +
                "[[1], [2], [6], [4]]\n" +
                "\n" +
                "\tCandidates: (0)\n" +
                "\n";

        System.out.println(SeqUtils.printSeqs(tdb));

        GSP gsp = new GSP(() -> tdb);
        List<GSP.GSPLevelStruct> ret = gsp.mine(2);
        TestUtils.StringEquals("gsp basic 1", corr1, printResults(ret), true);
    }

}